{% extends "base.html" %}

{% block title %}View Content - BlueAbel AIOS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Content Repository</h1>
    <p class="page-description">Browse and manage your content items.</p>
</div>

<div class="filter-controls">
    <form method="GET" action="{{ url_for('view_content') }}" class="filter-form">
        <div class="form-row">
            <div class="form-col">
                <label for="content-type">Type:</label>
                <select id="content-type" name="type" onchange="this.form.submit()">
                    <option value="">All Types</option>
                    <option value="url" {% if selected_type == 'url' %}selected{% endif %}>URL</option>
                    <option value="pdf" {% if selected_type == 'pdf' %}selected{% endif %}>PDF</option>
                    <option value="text" {% if selected_type == 'text' %}selected{% endif %}>Text</option>
                    <option value="email" {% if selected_type == 'email' %}selected{% endif %}>Email</option>
                </select>
            </div>
            <div class="form-col">
                <label for="sort-by">Sort By:</label>
                <select id="sort-by" name="sort" onchange="this.form.submit()">
                    <option value="date_desc" {% if selected_sort == 'date_desc' %}selected{% endif %}>Newest First</option>
                    <option value="date_asc" {% if selected_sort == 'date_asc' %}selected{% endif %}>Oldest First</option>
                    <option value="title" {% if selected_sort == 'title' %}selected{% endif %}>Title</option>
                </select>
            </div>
        </div>
    </form>
</div>

<div class="content-list">
    {% for item in content_items %}
    <div class="content-card">
        <div class="content-card-main">
            <h3 class="content-card-title">{{ item.title|default('Untitled Content') }}</h3>
            <div class="content-card-meta">
                {% set item_type = item.type|default(item.content_type|default('Unknown')) %}
                <span class="badge badge-type">{{ item_type }}</span>
                <span class="content-card-date">{{ format_date(item.created_at) }}</span>
            </div>
            <p class="content-card-summary">{{ item.summary|default('No summary available.') }}</p>
            <div class="content-card-tags">
                {% if item.tags and item.tags|length > 0 %}
                    {% for tag in item.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                {% else %}
                    <span class="tag">no tags</span>
                {% endif %}
            </div>
        </div>
        <div class="content-card-actions">
            <a href="{{ url_for('content_detail', content_id=item.id) }}" class="btn">View Details</a>
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <p>No content items found. Try adjusting your filters or adding new content.</p>
        <a href="{{ url_for('process_content') }}" class="btn btn-primary">Process New Content</a>
    </div>
    {% endfor %}
</div>

{% if pagination.total_pages > 1 %}
<div class="pagination">
    {% if pagination.has_prev %}
    <a href="{{ url_for('view_content', type=selected_type, sort=selected_sort, page=pagination.prev_page) }}" class="pagination-item">&laquo; Previous</a>
    {% else %}
    <span class="pagination-item disabled">&laquo; Previous</span>
    {% endif %}
    
    {% for p in pagination.pages %}
    {% if p == pagination.current_page %}
    <span class="pagination-item active">{{ p }}</span>
    {% else %}
    <a href="{{ url_for('view_content', type=selected_type, sort=selected_sort, page=p) }}" class="pagination-item">{{ p }}</a>
    {% endif %}
    {% endfor %}
    
    {% if pagination.has_next %}
    <a href="{{ url_for('view_content', type=selected_type, sort=selected_sort, page=pagination.next_page) }}" class="pagination-item">Next &raquo;</a>
    {% else %}
    <span class="pagination-item disabled">Next &raquo;</span>
    {% endif %}
</div>
{% endif %}
{% endblock %}